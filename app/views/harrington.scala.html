@main("Harrington Region") {
<script src="@routes.Assets.at("javascripts/three.js/CombinedCamera.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/three.js/three.min.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/three.js/stats.min.js")" type="text/javascript"></script>

<div class="container">
    <div class="row">
        <div class="span2">
            <div class="page-header">Harrington Region</div>
        </div>
        <div class="span2">
            <img class="img-rounded"
                 style="height: 75px; width:75px;"
                 src="@routes.Assets.at("images/newGrayson.png")">
        </div>
        <div class="span2">
            <button id="fetchData" class="btn btn-large">
                <i class="icon-refresh"></i> update
            </button>
        </div>
        <div class="span2">
            <button class="btn btn-large"><i class="icon-star"></i>
                <a href="/sensor/6140/12046/5be50dc4-f2f4-85ed-e45a-401978ebfcd8">
                    proxied data
                </a>
            </button>
        </div>
        <div class="span2">
            <button class="btn  btn-large"><i class="icon-star"></i>
                <a href="http://sim6140.agni.lindenlab.com:12046/cap/5be50dc4-f2f4-85ed-e45a-401978ebfcd8">
                    sensor direct
                </a>
            </button>
        </div>
    </div>
</div>

<div id="data"></div>



<script>

	var container, camera;

	init();
	animate();


	function init() {

		container = document.createElement( 'div' );
		document.body.appendChild( container );

		window.camera = new THREE.CombinedCamera( window.innerWidth /2, window.innerHeight/2, 70, 1, 1000, -1000, 1000, 1000 );

		camera.position.x = -512;
		camera.position.y = -512;
		camera.position.z = 200;

		window.scene = new THREE.Scene();

		// Grid

		var size = 256, step = 10;
		var geometry = new THREE.Geometry();
		for ( var i = - size; i <= size; i += step ) {

			geometry.vertices.push( new THREE.Vector3( - size, 0, i ) );
			geometry.vertices.push( new THREE.Vector3(   size, 0, i ) );

			geometry.vertices.push( new THREE.Vector3( i, 0, - size ) );
			geometry.vertices.push( new THREE.Vector3( i, 0,   size ) );

		}
		var material = new THREE.LineBasicMaterial( { color: 0x000000, opacity: 0.2 } );
		var line = new THREE.Line( geometry, material );
		line.type = THREE.LinePieces;
		window.scene.add( line );

        var debugaxis = function(axisLength){
            //Shorten the vertex function
            function v(x,y,z){
                    return new THREE.Vertex(new THREE.Vector3(x,y,z));
            }

            //Create axis (point1, point2, colour)
            function createAxis(p1, p2, color){
                    var line, lineGeometry = new THREE.Geometry(),
                    lineMat = new THREE.LineBasicMaterial({color: color, lineWidth: 1});
                    lineGeometry.vertices.push(p1, p2);
                    line = new THREE.Line(lineGeometry, lineMat);
                    window.scene.add(line);
            }

            createAxis(v(-axisLength, 0, 0), v(axisLength, 0, 0), 0xFF0000);
            createAxis(v(0, -axisLength, 0), v(0, axisLength, 0), 0x00FF00);
            createAxis(v(0, 0, -axisLength), v(0, 0, axisLength), 0x0000FF);
        };

        //To use enter the axis length
        debugaxis(256);

		// Lights

		var ambientLight = new THREE.AmbientLight( Math.random() * 0x10 );
		scene.add( ambientLight );

		var directionalLight = new THREE.DirectionalLight( Math.random() * 0xffffff );
		directionalLight.position.x = Math.random() - 0.5;
		directionalLight.position.y = Math.random() - 0.5;
		directionalLight.position.z = Math.random() - 0.5;
		directionalLight.position.normalize();
		window.scene.add( directionalLight );

		var directionalLight = new THREE.DirectionalLight( Math.random() * 0xffffff );
		directionalLight.position.x = Math.random() - 0.5;
		directionalLight.position.y = Math.random() - 0.5;
		directionalLight.position.z = Math.random() - 0.5;
		directionalLight.position.normalize();
		window.scene.add( directionalLight );

		window.renderer = new THREE.CanvasRenderer();
		window.renderer.setSize( window.innerWidth, window.innerHeight );

		container.appendChild( renderer.domElement );
		window.addEventListener( 'resize', onWindowResize, false );

		function onWindowResize(){

			window.camera.setSize( window.innerWidth, window.innerHeight );
			window.camera.updateProjectionMatrix();
			window.renderer.setSize( window.innerWidth, window.innerHeight );

		}

	}

	//

	function animate() {

		requestAnimationFrame( animate );

		render();
	//	stats.update();

	}

	function render() {

		var timer = Date.now() * 0.0001;

		camera.position.x = Math.cos( timer ) * 200;
		camera.position.z = Math.sin( timer ) * 200;
		camera.lookAt( window.scene.position );

		renderer.render( window.scene, camera );

	}
function threeUpdate() {
// Maggie's unrandom cubes
if (typeof window.sensorData !='undefined') {
    var agents = window.sensorData.body.agents;
    for (var i = 0; i < agents.length; i++) {
		var geometry = new THREE.CubeGeometry( 5, 5, 5 );
		var material = new THREE.MeshLambertMaterial( { color: 0xffffff, shading: THREE.FlatShading, overdraw: true } );
        var cube = new THREE.Mesh(geometry, material);
        var parsedPos = agents[i].pos.replace("<", "").replace(">", "").split(",");
        cube.scale.y = 5;
        cube.position.x = parsedPos[0];
        cube.position.y = parsedPos[1];
        cube.position.z = parsedPos[2];
        window.scene.add(cube);
    }
}
}

</script>

<script type="text/javascript">
    $('#fetchData').click(function (evt) {
        $('#errors').hide();
        $.ajax({
            type: 'GET',
            url: "/sensor/6140/12046/5be50dc4-f2f4-85ed-e45a-401978ebfcd8",
            success: function (data) {
                window.sensorData = data;
                threeUpdate();
                $('#data').html(showsensor(data));
            },
            error: function (data) {
                alert("oops:" + data);
            }
        });
        return false;
    });
</script>

}

